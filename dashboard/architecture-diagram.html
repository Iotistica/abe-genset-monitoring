<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABE Architecture Diagram</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a0f1e;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .diagram-container {
            max-width: 1400px;
            width: 100%;
            background: transparent;
            border-radius: 0;
            padding: 20px;
            box-shadow: none;
        }

        h1 {
            color: #FA7000;
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #a3b8d1;
            text-align: center;
            margin-bottom: 40px;
            font-size: 16px;
        }

        svg {
            width: 100%;
            height: auto;
        }

        /* Genset animations */
        .genset {
            transition: transform 0.3s ease;
        }

        .genset:hover {
            transform: scale(1.05);
        }

        .genset-icon {
            fill: #4a9eff;
        }

        .genset-status-running {
            fill: #10b981;
            animation: pulse 2s infinite;
        }

        .genset-status-standby {
            fill: #6b7280;
        }

        /* Data flow animation */
        .data-packet {
            animation: flowToEdge 3s ease-in-out infinite;
        }

        @keyframes flowToEdge {
            0% { offset-distance: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { offset-distance: 100%; opacity: 0; }
        }

        .data-packet-2 {
            animation: flowToEdge 3s ease-in-out infinite 1s;
        }

        .data-packet-3 {
            animation: flowToEdge 3s ease-in-out infinite 2s;
        }

        /* LTE signal animation */
        .lte-wave {
            animation: lteWave 2s ease-in-out infinite;
        }

        .lte-wave-2 {
            animation: lteWave 2s ease-in-out infinite 0.5s;
        }

        .lte-wave-3 {
            animation: lteWave 2s ease-in-out infinite 1s;
        }

        @keyframes lteWave {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
        }

        /* API cloud pulse */
        .api-cloud {
            animation: cloudPulse 3s ease-in-out infinite;
        }

        @keyframes cloudPulse {
            0%, 100% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Dashboard glow */
        .dashboard-screen {
            animation: dashboardGlow 2s ease-in-out infinite;
        }

        @keyframes dashboardGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(250, 112, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(250, 112, 0, 0.8)); }
        }

        /* Connection lines animation */
        .connection-line {
            stroke-dasharray: 10 5;
            animation: dashMove 1s linear infinite;
        }

        @keyframes dashMove {
            to { stroke-dashoffset: -15; }
        }

        /* Status pulse */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Text styles */
        .label-text {
            fill: #e8eef5;
            font-size: 14px;
            font-weight: 600;
        }

        .metric-text {
            fill: #FA7000;
            font-size: 12px;
            font-weight: 700;
        }

        .small-text {
            fill: #a3b8d1;
            font-size: 10px;
        }

        /* Interactive tooltip */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            min-width: 200px;
            max-width: 240px;
            white-space: nowrap;
        }

        .tooltip.show {
            opacity: 1;
        }
    </style>
    <script>
        // Translation dictionary
        const translations = {
            en: {
                title: "ABE System Architecture",
                subtitle: "Real-time Genset Monitoring & Control via 4G LTE",
                genset: "GenSet",
                main: "Main",
                backup1: "Backup",
                backup2: "Emergency",
                status: "Status",
                running: "Running",
                standby: "Standby",
                power: "Power",
                comapController: "ComAp Controller",
                controlUnit: "Control Unit",
                localNetworkHub: "Local Network Hub",
                dataAggregation: "Data Aggregation",
                lteGateway: "4G LTE Gateway",
                edgeModem: "Edge Modem",
                dataAggregator: "Data Aggregator",
                internet: "Internet",
                encrypted: "Encrypted",
                apiServer: "API Server",
                restfulAPI: "RESTful API",
                database: "Database",
                postgresql: "PostgreSQL",
                port: "Port",
                mqttBroker: "MQTT Broker",
                messageQueue: "Message Queue",
                dashboard: "ABE Dashboard",
                operationsView: "Operations View",
                technicianView: "Technician View",
                totalPower: "Total Power",
                activeUnits: "Active Units",
                alarms: "Alarms",
                user: "User",
                manager: "Manager",
                maintenance: "Maintenance",
                ok: "OK",
                nextService: "Next Service",
                days: "days",
                diagnostics: "Diagnostics",
                serialModbus: "Serial/Modbus",
                ethernet: "Ethernet",
                edgeDevice: "Edge Device",
                liveArchitecture: "Live Architecture Diagram",
                realtimeDataFlow: "Real-time Data Flow",
                cloudConnected: "Cloud-Connected"
            },
            ru: {
                title: "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã ABE",
                subtitle: "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ 4G LTE",
                genset: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä",
                main: "–û—Å–Ω–æ–≤–Ω–æ–π",
                backup1: "–†–µ–∑–µ—Ä–≤–Ω—ã–π",
                backup2: "–ê–≤–∞—Ä–∏–π–Ω—ã–π",
                status: "–°—Ç–∞—Ç—É—Å",
                running: "–†–∞–±–æ—Ç–∞–µ—Ç",
                standby: "–û–∂–∏–¥–∞–Ω–∏–µ",
                power: "–ú–æ—â–Ω–æ—Å—Ç—å",
                comapController: "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ComAp",
                controlUnit: "–ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
                localNetworkHub: "–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π —É–∑–µ–ª",
                dataAggregation: "–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö",
                lteGateway: "4G LTE —à–ª—é–∑",
                edgeModem: "–ì—Ä–∞–Ω–∏—á–Ω—ã–π –º–æ–¥–µ–º",
                dataAggregator: "–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö",
                internet: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç",
                encrypted: "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ",
                apiServer: "API –°–µ—Ä–≤–µ—Ä",
                restfulAPI: "RESTful API",
                database: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö",
                postgresql: "PostgreSQL",
                port: "–ü–æ—Ä—Ç",
                mqttBroker: "MQTT –ë—Ä–æ–∫–µ—Ä",
                messageQueue: "–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π",
                dashboard: "–ü–∞–Ω–µ–ª—å ABE",
                operationsView: "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å",
                technicianView: "–ü–∞–Ω–µ–ª—å —Ç–µ—Ö–Ω–∏–∫–∞",
                totalPower: "–û–±—â–∞—è –º–æ—â–Ω–æ—Å—Ç—å",
                activeUnits: "–ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",
                alarms: "–¢—Ä–µ–≤–æ–≥–∏",
                user: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                manager: "–ú–µ–Ω–µ–¥–∂–µ—Ä",
                maintenance: "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
                ok: "–û–ö",
                nextService: "–°–ª–µ–¥—É—é—â–µ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
                days: "–¥–Ω–µ–π",
                diagnostics: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
                serialModbus: "Serial/Modbus",
                ethernet: "Ethernet",
                edgeDevice: "–ì—Ä–∞–Ω–∏—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",
                liveArchitecture: "–ñ–∏–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã",
                realtimeDataFlow: "–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏",
                cloudConnected: "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–±–ª–∞–∫—É"
            }
        };

        // Detect language from parent window or use default
        let currentLang = 'en';
        
        function detectLanguage() {
            try {
                // First check URL parameter
                const urlParams = new URLSearchParams(window.location.search);
                const langParam = urlParams.get('lang');
                if (langParam && translations[langParam]) {
                    return langParam;
                }
                
                // Check parent window's localStorage
                if (window.parent && window.parent !== window) {
                    try {
                        const parentLang = window.parent.localStorage.getItem('language');
                        if (parentLang && translations[parentLang]) {
                            return parentLang;
                        }
                    } catch (e) {
                        console.log('Cannot access parent localStorage');
                    }
                    
                    // Check parent window's active language button
                    try {
                        const parentLangBtn = window.parent.document.querySelector('.lang-btn.active');
                        if (parentLangBtn) {
                            const lang = parentLangBtn.getAttribute('data-lang');
                            if (lang && translations[lang]) {
                                return lang;
                            }
                        }
                    } catch (e) {
                        console.log('Cannot access parent document');
                    }
                }
                
                // Check own localStorage
                const storedLang = localStorage.getItem('language');
                if (storedLang && translations[storedLang]) {
                    return storedLang;
                }
            } catch (e) {
                console.log('Error detecting language:', e);
            }
            return 'en';
        }

        // Function to update all text elements
        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // Update title and subtitle
            const titleEl = document.querySelector('h1');
            if (titleEl) titleEl.textContent = t.title;
            const subtitleEl = document.querySelector('.subtitle');
            if (subtitleEl) subtitleEl.textContent = t.subtitle;
            
            // Update footer text
            const footerText = document.getElementById('footer-text');
            if (footerText) {
                footerText.textContent = `üîÑ ${t.liveArchitecture} ‚Ä¢ üì° ${t.realtimeDataFlow} ‚Ä¢ üåê ${t.cloudConnected}`;
            }
            
            // Update SVG text elements by data-key attribute or content matching
            const textElements = document.querySelectorAll('text');
            textElements.forEach(el => {
                // Get the translation key stored in data attribute, or try to match content
                const key = el.getAttribute('data-i18n-key');
                const content = el.textContent.trim();
                
                // Skip genset names and power values
                if (content.startsWith('GenSet-') || content.match(/^\d+\s*kW$/)) {
                    return;
                }
                
                // Check all possible language values for this text
                let translationKey = null;
                for (const [k, v] of Object.entries(translations.en)) {
                    if (content === v || content === translations.ru[k] || 
                        content === v + ':' || content === translations.ru[k] + ':') {
                        translationKey = k;
                        break;
                    }
                }
                
                // Apply translation if found
                if (translationKey) {
                    const hasColon = content.endsWith(':');
                    el.textContent = t[translationKey] + (hasColon ? ':' : '');
                    el.setAttribute('data-i18n-key', translationKey);
                }
                
                // Handle port labels specially
                if (content.match(/Port\s+\d+/) || content.match(/–ü–æ—Ä—Ç\s+\d+/)) {
                    const portNum = content.match(/\d+/)[0];
                    el.textContent = t.port + ' ' + portNum;
                    el.setAttribute('data-i18n-key', 'port');
                }
                
                // Handle "15 days" / "15 –¥–Ω–µ–π"
                if (content.match(/^15\s+/)) {
                    el.textContent = '15 ' + t.days;
                    el.setAttribute('data-i18n-key', 'days');
                }
            });
            
            // Store current language
            localStorage.setItem('language', lang);
        }

        // Listen for language changes from parent window
        window.addEventListener('message', (event) => {
            if (event.data.type === 'languageChange') {
                updateLanguage(event.data.lang);
            }
        });

        // Apply translations on load
        window.addEventListener('DOMContentLoaded', () => {
            currentLang = detectLanguage();
            updateLanguage(currentLang);
            setupTooltips();
        });
        
        // Setup interactive tooltips for gensets
        function setupTooltips() {
            const gensetData = {
                'GenSet-01-Main': {
                    name: 'GenSet-01-Main',
                    power: '450 kW',
                    status: 'Running',
                    model: 'Cummins C500 D5',
                    voltage: '400V',
                    frequency: '50 Hz',
                    rpm: '1500 RPM',
                    fuel: '75%',
                    coolant: '82¬∞C',
                    oil: '95¬∞C',
                    runtime: '1,245 hrs',
                    location: 'Building A'
                },
                'GenSet-02-Backup': {
                    name: 'GenSet-02-Backup',
                    power: '0 kW',
                    status: 'Standby',
                    model: 'Perkins 2806A',
                    voltage: '400V',
                    frequency: '50 Hz',
                    rpm: '0 RPM',
                    fuel: '100%',
                    coolant: '25¬∞C',
                    oil: '28¬∞C',
                    runtime: '856 hrs',
                    location: 'Building B'
                },
                'GenSet-03-Emergency': {
                    name: 'GenSet-03-Emergency',
                    power: '320 kW',
                    status: 'Running',
                    model: 'Caterpillar C15',
                    voltage: '400V',
                    frequency: '50 Hz',
                    rpm: '1500 RPM',
                    fuel: '62%',
                    coolant: '88¬∞C',
                    oil: '92¬∞C',
                    runtime: '2,103 hrs',
                    location: 'Building C'
                }
            };
            
            // Create tooltip element
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            document.body.appendChild(tooltip);
            
            // Add hover events to genset groups
            document.querySelectorAll('.genset').forEach(genset => {
                const name = genset.getAttribute('data-name');
                const data = gensetData[name];
                
                if (!data) return;
                
                genset.style.cursor = 'pointer';
                
                genset.addEventListener('mouseenter', (e) => {
                    const t = translations[currentLang];
                    tooltip.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 8px; color: #FA7000; font-size: 12px; border-bottom: 1px solid #FA7000; padding-bottom: 5px; line-height: 1.3;">${data.name}</div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">${t.status || 'Status'}:</span> <span style="color: white; margin-left: 10px;">${data.status === 'Running' ? (t.running || 'Running') : (t.standby || 'Standby')}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">${t.power || 'Power'}:</span> <span style="color: #FA7000; margin-left: 10px; font-weight: bold;">${data.power}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Model:</span> <span style="color: white; margin-left: 10px;">${data.model}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Voltage:</span> <span style="color: white; margin-left: 10px;">${data.voltage}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Frequency:</span> <span style="color: white; margin-left: 10px;">${data.frequency}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">${t.rpm || 'RPM'}:</span> <span style="color: white; margin-left: 10px;">${data.rpm}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">${t.fuel || 'Fuel'}:</span> <span style="color: white; margin-left: 10px;">${data.fuel}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Coolant:</span> <span style="color: white; margin-left: 10px;">${data.coolant}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Oil:</span> <span style="color: white; margin-left: 10px;">${data.oil}</span></div>
                        <div style="margin-bottom: 4px; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">Runtime:</span> <span style="color: white; margin-left: 10px;">${data.runtime}</span></div>
                        <div style="margin-bottom: 0; display: flex; justify-content: space-between; line-height: 1.3;"><span style="color: #a3b8d1;">${t.location || 'Location'}:</span> <span style="color: white; margin-left: 10px;">${data.location}</span></div>
                    `;
                    tooltip.classList.add('show');
                });
                
                genset.addEventListener('mousemove', (e) => {
                    tooltip.style.left = (e.clientX + 15) + 'px';
                    tooltip.style.top = (e.clientY + 15) + 'px';
                });
                
                genset.addEventListener('mouseleave', () => {
                    tooltip.classList.remove('show');
                });
            });
        }
    </script>
</head>
<body>
    <div class="diagram-container">
        
        <svg viewBox="0 0 1400 700" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <!-- Gradients -->
                <linearGradient id="gensetGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#4a9eff;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="edgeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#6366f1;stop-opacity:1" />
                </linearGradient>

                <linearGradient id="cloudGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                </linearGradient>

                <!-- Arrow markers for bidirectional communication -->
                <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#10b981" />
                </marker>
                <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b" />
                </marker>
                <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#8b5cf6" />
                </marker>

                <!-- Path for data flow -->
                <path id="flowPath1" d="M 150 150 Q 250 150, 400 250" fill="none"/>
                <path id="flowPath2" d="M 150 350 Q 250 350, 400 250" fill="none"/>
                <path id="flowPath3" d="M 150 550 Q 250 550, 400 250" fill="none"/>
            </defs>

            <!-- Connection Lines -->
            <line x1="330" y1="160" x2="380" y2="160" stroke="#4a9eff" stroke-width="2" opacity="0.3" class="connection-line"/>
            <line x1="330" y1="350" x2="380" y2="350" stroke="#4a9eff" stroke-width="2" opacity="0.3" class="connection-line"/>
            <line x1="330" y1="540" x2="380" y2="540" stroke="#4a9eff" stroke-width="2" opacity="0.3" class="connection-line"/>
            
            <line x1="480" y1="160" x2="580" y2="280" stroke="#8b5cf6" stroke-width="2" opacity="0.4" class="connection-line"/>
            <line x1="480" y1="350" x2="580" y2="320" stroke="#8b5cf6" stroke-width="2" opacity="0.4" class="connection-line"/>
            <line x1="480" y1="540" x2="580" y2="360" stroke="#8b5cf6" stroke-width="2" opacity="0.4" class="connection-line"/>
            
            <line x1="700" y1="320" x2="900" y2="320" stroke="#8b5cf6" stroke-width="2" opacity="0.5" class="connection-line"/>
            
            <!-- Internet Visualization -->
            <g class="internet-waves">
                <!-- Wireless signal waves -->
                <path d="M 750 300 Q 800 280, 850 300" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0.4">
                    <animate attributeName="opacity" values="0.4;0.1;0.4" dur="2s" repeatCount="indefinite"/>
                </path>
                <path d="M 740 290 Q 800 260, 860 290" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0.3">
                    <animate attributeName="opacity" values="0.3;0.1;0.3" dur="2s" repeatCount="indefinite" begin="0.5s"/>
                </path>
                <path d="M 730 280 Q 800 240, 870 280" fill="none" stroke="#3b82f6" stroke-width="1.5" opacity="0.2">
                    <animate attributeName="opacity" values="0.2;0.05;0.2" dur="2s" repeatCount="indefinite" begin="1s"/>
                </path>
                
                <!-- Data transfer indicator -->
                <text x="800" y="365" text-anchor="middle" class="small-text" font-size="12" fill="#3b82f6">Internet</text>
                <text x="800" y="380" text-anchor="middle" class="small-text" font-size="11" fill="#60a5fa">Encrypted</text>
            </g>
            
            <!-- Bidirectional arrows: Gateway to API (top) -->
            <line x1="700" y1="290" x2="900" y2="290" stroke="#10b981" stroke-width="2" opacity="0.5" class="connection-line" marker-end="url(#arrowGreen)"/>
            <line x1="900" y1="305" x2="700" y2="305" stroke="#10b981" stroke-width="2" opacity="0.5" class="connection-line" marker-end="url(#arrowGreen)"/>
            <line x1="975" y1="270" x2="975" y2="200" stroke="#10b981" stroke-width="2" opacity="0.5" class="connection-line"/>
            
            <!-- Bidirectional arrows: Gateway to MQTT (bottom) -->
            <line x1="700" y1="350" x2="900" y2="450" stroke="#f59e0b" stroke-width="2" opacity="0.5" class="connection-line" marker-end="url(#arrowOrange)"/>
            <line x1="900" y1="465" x2="700" y2="365" stroke="#f59e0b" stroke-width="2" opacity="0.5" class="connection-line" marker-end="url(#arrowOrange)"/>
            <line x1="975" y1="370" x2="975" y2="440" stroke="#f59e0b" stroke-width="2" opacity="0.5" class="connection-line"/>
            
            <line x1="1050" y1="320" x2="1190" y2="360" stroke="#10b981" stroke-width="3" opacity="0.4" class="connection-line"/>
            <line x1="1050" y1="310" x2="1190" y2="175" stroke="#6366f1" stroke-width="2" opacity="0.3" class="connection-line"/>
            <line x1="1050" y1="330" x2="1190" y2="595" stroke="#f59e0b" stroke-width="2" opacity="0.3" class="connection-line"/>

            <!-- Animated Data Packets (up to Gateway only) -->
            <!-- Flow from genset 1 -->
            <circle r="5" fill="#FA7000">
                <animateMotion dur="3s" repeatCount="indefinite" path="M 200 160 L 260 160 L 330 160 L 380 160 L 480 160 L 580 280 L 640 300"/>
            </circle>
            <!-- Flow from genset 2 -->
            <circle r="5" fill="#10b981">
                <animateMotion dur="3s" repeatCount="indefinite" begin="1s" path="M 200 350 L 260 350 L 330 350 L 380 350 L 480 350 L 580 320 L 640 320"/>
            </circle>
            <!-- Flow from genset 3 -->
            <circle r="5" fill="#fbbf24">
                <animateMotion dur="3s" repeatCount="indefinite" begin="2s" path="M 200 540 L 260 540 L 330 540 L 380 540 L 480 540 L 580 360 L 640 340"/>
            </circle>

            <!-- GENSETS with ComAp Controllers (Left side) -->
            <g class="genset" data-name="GenSet-01-Main">
                <rect x="50" y="120" width="200" height="80" rx="8" fill="url(#gensetGradient)" opacity="0.9"/>
                <circle cx="70" cy="140" r="8" class="genset-status-running"/>
                <text x="145" y="155" text-anchor="middle" class="label-text">GenSet-01-Main</text>
                <text x="145" y="175" text-anchor="middle" class="metric-text">450 kW</text>
                <text x="145" y="190" text-anchor="middle" class="small-text">Running</text>
            </g>
            <!-- ComAp Controller 1 -->
            <g class="edge-device">
                <rect x="260" y="135" width="70" height="50" rx="6" fill="url(#edgeGradient)" opacity="0.9"/>
                <text x="295" y="162" text-anchor="middle" class="small-text" font-size="8">ComAp</text>
                <text x="295" y="172" text-anchor="middle" class="small-text" font-size="7">IG-200</text>
            </g>

            <g class="genset" data-name="GenSet-02-Backup">
                <rect x="50" y="320" width="200" height="80" rx="8" fill="url(#gensetGradient)" opacity="0.9"/>
                <circle cx="70" cy="340" r="8" class="genset-status-standby"/>
                <text x="145" y="355" text-anchor="middle" class="label-text">GenSet-02-Backup</text>
                <text x="145" y="375" text-anchor="middle" class="metric-text">0 kW</text>
                <text x="145" y="390" text-anchor="middle" class="small-text">Standby</text>
            </g>
            <!-- ComAp Controller 2 -->
            <g class="edge-device">
                <rect x="260" y="335" width="70" height="50" rx="6" fill="url(#edgeGradient)" opacity="0.9"/>
                <text x="295" y="362" text-anchor="middle" class="small-text" font-size="8">ComAp</text>
                <text x="295" y="372" text-anchor="middle" class="small-text" font-size="7">IG-200</text>
            </g>

            <g class="genset" data-name="GenSet-03-Emergency">
                <rect x="50" y="520" width="200" height="80" rx="8" fill="url(#gensetGradient)" opacity="0.9"/>
                <circle cx="70" cy="540" r="8" class="genset-status-running"/>
                <text x="145" y="555" text-anchor="middle" class="label-text">GenSet-03-Emergency</text>
                <text x="145" y="575" text-anchor="middle" class="metric-text">320 kW</text>
                <text x="145" y="590" text-anchor="middle" class="small-text">Running</text>
            </g>
            <!-- ComAp Controller 3 -->
            <g class="edge-device">
                <rect x="260" y="535" width="70" height="50" rx="6" fill="url(#edgeGradient)" opacity="0.9"/>
                <text x="295" y="562" text-anchor="middle" class="small-text" font-size="8">ComAp</text>
                <text x="295" y="572" text-anchor="middle" class="small-text" font-size="7">IC-NT</text>
            </g>

            <!-- Network Hub/Gateway -->
            <g class="network-hub">
                <rect x="380" y="130" width="100" height="440" rx="10" fill="#1e3a5f" opacity="0.3" stroke="#4a9eff" stroke-width="2"/>
                <text x="430" y="110" text-anchor="middle" class="label-text">Local Network</text>
            </g>

            <!-- Network Hub/Gateway -->
                <rect x="380" y="130" width="100" height="440" rx="10" fill="#1e3a5f" opacity="0.3" stroke="#4a9eff" stroke-width="2"/>
                <text x="430" y="110" text-anchor="middle" class="label-text">Local Network</text>
            </g>

            <!-- 4G LTE Gateway (Centered vertically) -->
            <g class="lte-gateway">
                <rect x="580" y="240" width="120" height="160" rx="10" fill="url(#edgeGradient)" opacity="0.9"/>
                <text x="640" y="225" text-anchor="middle" class="label-text">4G LTE Gateway</text>
                <circle cx="640" cy="310" r="12" fill="#FA7000" opacity="0.8">
                    <animate attributeName="opacity" values="0.8;1;0.8" dur="1.5s" repeatCount="indefinite"/>
                </circle>
                <!-- 4G/LTE Wireless icon -->
                <path d="M 640 305 L 640 315" stroke="white" stroke-width="2"/>
                <path d="M 634 308 Q 640 302, 646 308" fill="none" stroke="white" stroke-width="1.5"/>
                <path d="M 630 311 Q 640 299, 650 311" fill="none" stroke="white" stroke-width="1.5"/>
                
                <text x="640" y="340" text-anchor="middle" class="small-text">Edge Modem</text>
                <text x="640" y="355" text-anchor="middle" class="small-text" font-size="10">Modbus Client</text>
                <text x="640" y="370" text-anchor="middle" class="small-text" font-size="9">Data Aggregator</text>
                <text x="640" y="390" text-anchor="middle" class="metric-text" font-size="10">‚Üë 2.3 MB/s</text>
            </g>

            <!-- 4G LTE Waves (removed) -->
            <g class="lte-signals">
            </g>

            <!-- API Cloud (Rectangular design, no ovals) -->
            <g>
                <rect x="900" y="270" width="150" height="100" rx="15" fill="url(#cloudGradient)" opacity="0.7"/>
                <path d="M 920 270 Q 920 260, 930 260 L 1030 260 Q 1040 260, 1040 270" fill="url(#cloudGradient)" opacity="0.8"/>
                
                <text x="975" y="315" text-anchor="middle" class="label-text" fill="white">API Server</text>
                <text x="975" y="335" text-anchor="middle" class="small-text">Cloud Backend</text>
                <text x="975" y="350" text-anchor="middle" class="small-text">Port 3001</text>
            </g>

            <!-- Database (Top) -->
            <g class="database">
                <rect x="900" y="120" width="150" height="80" rx="10" fill="#1e293b" opacity="0.9" stroke="#10b981" stroke-width="2"/>
                <text x="975" y="150" text-anchor="middle" class="label-text" fill="white">Database</text>
                <text x="975" y="170" text-anchor="middle" class="small-text">PostgreSQL</text>
                <text x="975" y="185" text-anchor="middle" class="small-text" font-size="9">Port 5432</text>
            </g>

            <!-- MQTT Broker (Bottom) -->
            <g class="mqtt-broker">
                <rect x="900" y="440" width="150" height="80" rx="10" fill="#1e293b" opacity="0.9" stroke="#f59e0b" stroke-width="2"/>
                <text x="975" y="470" text-anchor="middle" class="label-text" fill="white">MQTT Broker</text>
                <text x="975" y="490" text-anchor="middle" class="small-text">Message Queue</text>
                <text x="975" y="505" text-anchor="middle" class="small-text" font-size="9">Port 1883</text>
            </g>

            <!-- Dashboard (Right side) -->
            <g class="dashboard">
                <rect x="1190" y="300" width="180" height="180" rx="12" fill="#152238" opacity="0.95" class="dashboard-screen"/>
                <rect x="1200" y="315" width="160" height="30" rx="4" fill="#FA7000" opacity="0.9"/>
                <text x="1280" y="335" text-anchor="middle" class="label-text">ABE Dashboard</text>
                
                <!-- Metrics display -->
                <text x="1210" y="365" class="small-text">Total Power:</text>
                <text x="1350" y="365" text-anchor="end" class="metric-text">770 kW</text>
                
                <text x="1210" y="390" class="small-text">Active Units:</text>
                <text x="1350" y="390" text-anchor="end" class="metric-text">2/3</text>
                
                <text x="1210" y="415" class="small-text">Alarms:</text>
                <text x="1350" y="415" text-anchor="end" class="metric-text">0</text>
                
                <text x="1210" y="440" class="small-text">Status:</text>
                <text x="1350" y="440" text-anchor="end" class="metric-text" fill="#10b981">Online</text>
                
                <text x="1210" y="465" class="small-text">Last Update:</text>
                <text x="1350" y="465" text-anchor="end" class="small-text">Just now</text>
                
                <!-- Control buttons -->
                <rect x="1205" y="355" width="4" height="120" rx="2" fill="#10b981" opacity="0.6">
                    <animate attributeName="height" values="120;80;120" dur="2s" repeatCount="indefinite"/>
                </rect>
            </g>

            <!-- Dashboard Top (Operations Manager) -->
            <g class="dashboard">
                <rect x="1190" y="100" width="180" height="150" rx="12" fill="#152238" opacity="0.95" class="dashboard-screen"/>
                <rect x="1200" y="115" width="160" height="25" rx="4" fill="#6366f1" opacity="0.9"/>
                <text x="1280" y="132" text-anchor="middle" class="label-text" font-size="12">Operations View</text>
                
                <text x="1210" y="160" class="small-text" font-size="9">System Status:</text>
                <text x="1350" y="160" text-anchor="end" class="metric-text" font-size="9" fill="#10b981">Normal</text>
                
                <text x="1210" y="180" class="small-text" font-size="9">Load Balance:</text>
                <text x="1350" y="180" text-anchor="end" class="metric-text" font-size="9">Optimal</text>
                
                <text x="1210" y="200" class="small-text" font-size="9">Efficiency:</text>
                <text x="1350" y="200" text-anchor="end" class="metric-text" font-size="9">94%</text>
                
                <text x="1210" y="220" class="small-text" font-size="9">User:</text>
                <text x="1350" y="220" text-anchor="end" class="small-text" font-size="8">Manager</text>
                
                <rect x="1205" y="155" width="3" height="70" rx="1.5" fill="#6366f1" opacity="0.5">
                    <animate attributeName="height" values="70;50;70" dur="1.8s" repeatCount="indefinite"/>
                </rect>
            </g>

            <!-- Dashboard Bottom (Technician View) -->
            <g class="dashboard">
                <rect x="1190" y="520" width="180" height="150" rx="12" fill="#152238" opacity="0.95" class="dashboard-screen"/>
                <rect x="1200" y="535" width="160" height="25" rx="4" fill="#f59e0b" opacity="0.9"/>
                <text x="1280" y="552" text-anchor="middle" class="label-text" font-size="12">Technician View</text>
                
                <text x="1210" y="580" class="small-text" font-size="9">Maintenance:</text>
                <text x="1350" y="580" text-anchor="end" class="metric-text" font-size="9" fill="#10b981">OK</text>
                
                <text x="1210" y="600" class="small-text" font-size="9">Next Service:</text>
                <text x="1350" y="600" text-anchor="end" class="small-text" font-size="8">15 days</text>
                
                <text x="1210" y="620" class="small-text" font-size="9">Diagnostics:</text>
                <text x="1350" y="620" text-anchor="end" class="metric-text" font-size="9">Running</text>
                
                <text x="1210" y="640" class="small-text" font-size="9">User:</text>
                <text x="1350" y="640" text-anchor="end" class="small-text" font-size="8">Tech-01</text>
                
                <rect x="1205" y="575" width="3" height="70" rx="1.5" fill="#f59e0b" opacity="0.5">
                    <animate attributeName="height" values="70;50;70" dur="2.2s" repeatCount="indefinite"/>
                </rect>
            </g>

            <!-- Connection status indicators -->
            <g class="status-indicators">
            </g>

            <!-- Data flow labels -->
            <text x="295" y="80" text-anchor="middle" class="small-text">Serial/Modbus</text>
            <text x="430" y="80" text-anchor="middle" class="small-text">Ethernet</text>
            <text x="640" y="205" text-anchor="middle" class="small-text">Edge Device</text>
            <text x="1280" y="85" text-anchor="middle" class="small-text" font-size="9">Manager</text>
            <text x="1280" y="280" text-anchor="middle" class="small-text">Main Dashboard</text>
            <text x="1280" y="505" text-anchor="middle" class="small-text" font-size="9">Technician</text>
        </svg>

        <div style="text-align: center; margin-top: 30px; color: #a3b8d1; font-size: 14px;">
            <p id="footer-text">üîÑ Live Architecture Diagram ‚Ä¢ üì° Real-time Data Flow ‚Ä¢ üåê Cloud-Connected</p>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Update metrics periodically
        setInterval(() => {
            const powerValues = ['770 kW', '785 kW', '750 kW', '795 kW'];
            const randomPower = powerValues[Math.floor(Math.random() * powerValues.length)];
            document.querySelectorAll('.metric-text')[0].textContent = randomPower;
        }, 3000);
    </script>
</body>
</html>
